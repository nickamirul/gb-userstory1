# Math Calculator - Full Stack Application

A secure, full-stack math calculator application featuring a React frontend and Node.js backend that communicate via HTTPS REST API with API key authentication and SSL/TLS encryption. This project demonstrates modern web development practices, secure API communication, and comprehensive mathematical expression parsing.

## 📋 Project Overview

This application fulfills User Story 1 requirements by providing:

- **Frontend**: Modern React web interface for mathematical calculations
- **Backend**: Secure Node.js/Express API server with authentication
- **Communication**: HTTPS REST API calls between client and server
- **Security**: API key authentication for all requests
- **Validation**: Comprehensive input validation and error handling

### Key Features

✅ **Mathematical Operations**: Addition (+), Subtraction (-), Multiplication (*), Division (/)  
✅ **Operator Precedence**: *, / have higher precedence over +, -  
✅ **Parentheses Support**: Override operator precedence with parentheses  
✅ **API Key Authentication**: Secure endpoint access  
✅ **Real-time Validation**: Input validation with user-friendly error messages  
✅ **Calculation History**: Local storage of previous calculations  
✅ **Responsive Design**: Modern UI with TailwindCSS  
✅ **Comprehensive Testing**: Extensive positive and negative test cases  

## 🛠 Technology Stack

### Frontend
- **Framework**: React 19.1.1
- **Build Tool**: Vite 7.1.2
- **Styling**: TailwindCSS 3.4.17
- **HTTP Client**: Axios 1.11.0
- **Icons**: Lucide React
- **Utilities**: clsx, tailwind-merge

### Backend
- **Runtime**: Node.js (≥14.0.0)
- **Framework**: Express.js 4.18.2
- **Security**: Helmet 7.1.0
- **CORS**: cors 2.8.5
- **Rate Limiting**: express-rate-limit 7.1.5
- **Environment**: dotenv 16.6.1

## 📁 Project Structure

```
gb-userstory1/
├── README.md                 # This file
├── .gitignore               # Git ignore rules (includes *.pem, .env)
├── certs/                   # SSL certificates (local development)
│   ├── localhost.pem        # SSL certificate (git-ignored)
│   └── localhost-key.pem    # Private key (git-ignored)
├── frontend/                # React frontend application
│   ├── .env                 # Frontend environment variables (git-ignored)
│   ├── src/
│   │   ├── components/
│   │   │   └── Calculator.jsx    # Main calculator component
│   │   ├── config/
│   │   │   └── https.config.js   # HTTPS fallback configuration
│   │   ├── services/
│   │   │   └── api.js           # API service and utilities
│   │   ├── utils/
│   │   │   └── index.js         # Utility functions
│   │   ├── App.jsx              # Main app component
│   │   ├── main.jsx             # Application entry point
│   │   └── index.css            # Global styles
│   ├── package.json
│   └── vite.config.js       # Vite configuration with HTTPS setup
└── backend/                 # Node.js backend server
    ├── .env                 # Backend environment variables (git-ignored)
    ├── middleware/
    │   ├── auth.js          # API key authentication
    │   ├── logging.js       # Request logging
    │   ├── rateLimit.js     # Rate limiting
    │   └── validation.js    # Input validation
    ├── routes/
    │   ├── api.js          # Calculation endpoints
    │   └── index.js        # Route management
    ├── utils/
    │   └── mathParser.js   # Mathematical expression parser
    ├── config.js           # Configuration management
    ├── https.config.js     # HTTPS fallback configuration  
    ├── server.js           # Main HTTPS server file
    ├── test.js             # Comprehensive test suite
    └── package.json
```

## 🚀 Quick Start

### Prerequisites

- Node.js (v14 or higher)
- npm or yarn
- Git

### Installation & Setup

1. **Clone the repository**:
   ```bash
   git clone <repository-url>
   cd gb-userstory1
   ```

2. **Backend Setup**:
   ```bash
   cd backend
   npm install
   npm start
   ```
   The backend server will start on `https://localhost:3001`

3. **Frontend Setup** (in a new terminal):
   ```bash
   cd frontend
   npm install
   npm run dev
   ```
   The frontend will be available at `https://localhost:5173`

## 🔒 HTTPS Setup & SSL Certificates

This application uses **HTTPS for secure local development** with locally-trusted SSL certificates generated by `mkcert`.

### Prerequisites for HTTPS

1. **Install mkcert** (creates locally-trusted development certificates):
   ```bash
   # macOS (using Homebrew)
   brew install mkcert
   
   # Ubuntu/Debian
   sudo apt install libnss3-tools
   wget -O mkcert https://github.com/FiloSottile/mkcert/releases/latest/download/mkcert-v*-linux-amd64
   chmod +x mkcert
   sudo mv mkcert /usr/local/bin/
   
   # Windows (using Chocolatey)
   choco install mkcert
   ```

2. **Install mkcert root CA**:
   ```bash
   mkcert -install
   ```
   This installs the mkcert Certificate Authority in your system's trust store.

### SSL Certificate Generation

1. **Create certificates directory**:
   ```bash
   mkdir -p certs
   ```

2. **Generate SSL certificates**:
   ```bash
   mkcert -key-file certs/localhost-key.pem -cert-file certs/localhost.pem localhost 127.0.0.1 ::1
   ```

This creates:
- `certs/localhost.pem` - SSL certificate file
- `certs/localhost-key.pem` - Private key file (⚠️ Keep secure)

### Environment Configuration

Create `.env` files in both frontend and backend directories:

**Backend `.env`** (`backend/.env`):
```env
# Backend Environment Configuration
PORT=3001
NODE_ENV=development
API_KEY=math-calculator-api-key
```

**Frontend `.env`** (`frontend/.env`):
```env
# Frontend Environment Configuration
VITE_API_BASE_URL=https://localhost:3001
VITE_API_KEY=math-calculator-api-key
```

### 🔐 SSL Certificate Security

- **✅ Locally-trusted**: No browser security warnings
- **🔒 Development-only**: These certificates are for local development
- **📁 Gitignored**: Certificate files are excluded from version control
- **⏰ Auto-expires**: mkcert certificates expire automatically (typically 2-3 years)
- **🔄 Regeneratable**: Can be recreated anytime with the same mkcert commands

### Why HTTPS for Local Development?

1. **🛡️ Security Best Practice**: Matches production environment
2. **🔒 Encrypted Communication**: Protects API keys and data in transit
3. **📱 PWA Compatibility**: Required for Progressive Web App features
4. **🌐 Modern Web APIs**: Many browser APIs require HTTPS
5. **🎯 Testing Realism**: Tests under production-like conditions

### Available Scripts

#### Backend
- `npm start` - Start production server
- `npm run dev` - Start development server with nodemon
- `npm test` - Run comprehensive test suite

#### Frontend
- `npm run dev` - Start development server
- `npm run build` - Build for production
- `npm run preview` - Preview production build
- `npm run lint` - Run ESLint

## 🔐 API Authentication

All API requests require authentication via API key in the request headers:

```javascript
Headers: {
  "X-API-Key": "math-calculator-api-key"
  // or alternatively:
  // "Authorization": "math-calculator-api-key"
}
```

## 📡 API Endpoints

### Calculate Expression

```https
POST https://localhost:3001/api/v1/calculate
Content-Type: application/json
X-API-Key: math-calculator-api-key

{
  "expression": "2 + 3 * 4"
}
```

#### Success Response
```json
{
  "success": true,
  "expression": "2 + 3 * 4",
  "result": 14,
  "timestamp": "2024-01-01T12:00:00.000Z"
}
```

#### Error Response
```json
{
  "success": false,
  "error": "Division by zero is not allowed",
  "code": "DIVISION_BY_ZERO",
  "expression": "5 / 0"
}
```

## 🧪 Test Cases

### Positive Test Cases ✅

| Test Case | Expression | Expected Result | Description |
|-----------|------------|-----------------|-------------|
| 1 | `2 + 3` | `5` | Simple addition |
| 2 | `10 - 4` | `6` | Simple subtraction |
| 3 | `3 * 4` | `12` | Simple multiplication |
| 4 | `15 / 3` | `5` | Simple division |
| 5 | `2 + 3 * 4` | `14` | Operator precedence (multiplication first) |
| 6 | `(2 + 3) * 4` | `20` | Parentheses override precedence |
| 7 | `10 / 2 + 3` | `8` | Division before addition |
| 8 | `2.5 + 1.5` | `4` | Decimal numbers |
| 9 | `100 - 50 + 25` | `75` | Multiple operations (left to right) |
| 10 | `2 * 3 + 4 * 5` | `26` | Multiple multiplication operations |

### Negative Test Cases ❌

| Test Case | Expression | Expected Behavior | Description |
|-----------|------------|-------------------|-------------|
| 1 | `5 / 0` | Error: "Division by zero is not allowed" | Division by zero |
| 2 | `2 +` | Error: "Invalid expression" | Incomplete expression |
| 3 | `+ 3` | Error: "Invalid expression" | Expression starting with operator |
| 4 | `(2 + 3` | Error: "Mismatched parentheses" | Unclosed parenthesis |
| 5 | `2 + 3)` | Error: "Mismatched parentheses" | Extra closing parenthesis |
| 6 | `2 ** 3` | Error: "Invalid character" | Unsupported operator |
| 7 | `2 & 3` | Error: "Invalid character" | Invalid character |
| 8 | `` | Error: "Expression cannot be empty" | Empty expression |
| 9 | `   ` | Error: "Expression cannot be empty" | Whitespace only |
| 10 | `2..5 + 3` | Error: "Invalid character" | Invalid number format |

### API Authentication Test Cases 🔑

| Test Case | Scenario | Expected Result |
|-----------|----------|-----------------|
| 1 | Valid API key | 200 OK with calculation result |
| 2 | Missing API key | 401 Unauthorized |
| 3 | Invalid API key | 401 Unauthorized |
| 4 | Malformed API key | 401 Unauthorized |

## 🏃‍♂️ Running Tests

### Backend Tests
```bash
cd backend
npm test
```

This will run all test cases and display results:
- ✅ Positive test cases (mathematical operations)
- ❌ Negative test cases (error handling)
- 🔑 API authentication tests

### Manual Frontend Testing
1. Open the calculator at `https://localhost:5173`
2. Try the test expressions listed above
3. Verify error handling for invalid inputs
4. Test the calculation history feature

## 🔧 Configuration

### Environment Variables

Both frontend and backend use `.env` files for configuration:

#### Backend Configuration (`backend/.env`)
```env
# Server Configuration
PORT=3001                           # HTTPS server port
NODE_ENV=development                 # Environment mode (development/production)

# Security
API_KEY=math-calculator-api-key     # API authentication key
```

#### Frontend Configuration (`frontend/.env`)
```env
# API Configuration  
VITE_API_BASE_URL=https://localhost:3001    # Backend HTTPS URL
VITE_API_KEY=math-calculator-api-key        # API authentication key
```

### Configuration Priority

1. **Environment variables** (`.env` files) - **Highest Priority**
2. **Fallback configurations** (`https.config.js` files) - Used if `.env` is missing

### SSL Certificate Configuration

Both frontend and backend automatically use SSL certificates from:
- **Certificate**: `certs/localhost.pem`
- **Private Key**: `certs/localhost-key.pem`

These paths are configured in:
- **Frontend**: `vite.config.js` (Vite HTTPS server)
- **Backend**: `server.js` (Express HTTPS server)

## 🛡 Security Features

1. **🔒 HTTPS/TLS Encryption**: End-to-end encryption for all communications
2. **🔑 API Key Authentication**: All endpoints protected with API key validation  
3. **🛡️ SSL Certificates**: Locally-trusted development certificates via mkcert
4. **✅ Input Validation**: Comprehensive sanitization and validation of mathematical expressions
5. **⏱️ Rate Limiting**: Configurable request rate limiting to prevent abuse
6. **🌐 CORS Configuration**: Controlled cross-origin resource sharing
7. **🔐 Security Headers**: Helmet.js provides additional security headers
8. **❌ Error Handling**: Prevents information leakage through detailed error messages

## 🌟 Additional Features

### Frontend
- **Real-time Validation**: Input validation with immediate feedback
- **Calculation History**: Stores up to 50 previous calculations in localStorage
- **Copy to Clipboard**: Easy copying of calculation results
- **Responsive Design**: Mobile-first approach with TailwindCSS
- **Accessibility**: ARIA labels, keyboard navigation, screen reader support
- **Loading States**: Visual feedback during API calls
- **Offline Detection**: Shows connection status

### Backend
- **Mathematical Parser**: Custom implementation using Shunting Yard algorithm
- **Comprehensive Logging**: Request logging middleware
- **Error Categories**: Detailed error codes for different failure types
- **Rate Limiting**: Configurable request throttling
- **Health Monitoring**: Server status and connection monitoring

## 📈 Performance Considerations

- **Frontend**: Optimized bundle size with Vite, lazy loading, and efficient React patterns
- **Backend**: Lightweight Express server with minimal dependencies
- **API**: Efficient mathematical parsing with proper error handling
- **Caching**: Browser caching for static assets and calculation history

## 🌐 Browser Support

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## 🤝 Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## 📄 License

This project is licensed under the MIT License - see the package.json files for details.

## 👨‍💻 Author

**Amirul Ismail**

---

**Note**: This project demonstrates full-stack development best practices including secure API communication, proper error handling, comprehensive testing, and modern web technologies.